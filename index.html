<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ë§ê½ƒ í†¡í†¡</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <style>
        html, body { margin: 0; padding: 0; height: 100%; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; background-color: #f0f0f0; display: flex; justify-content: center; align-items: center; }
        #app-frame { position: relative; width: 100%; max-width: 450px; height: 100%; max-height: 900px; margin: auto; box-shadow: 0 4px 20px rgba(0,0,0,0.1); border-radius: 20px; overflow: hidden; display: flex; flex-direction: column; background-color: white; }
        #splash-screen { display: flex; justify-content: center; align-items: center; width: 100%; height: 100%; background-image: url('images/splash.png'); background-color: #ffffff; background-size: cover; background-position: center; background-repeat: no-repeat; cursor: pointer; position: absolute; top: 0; left: 0; z-index: 100; transition: opacity 0.5s ease-in-out; }
        #app-container { display: none; flex-direction: column; height: 100%; width: 100%; }
        .mode-selector { padding: 15px; text-align: center; background-color: #fafafa; border-bottom: 1px solid #eee; }
        .mode-button { padding: 10px 20px; font-size: 1em; font-weight: 600; margin: 0 5px; cursor: pointer; background: #eee; border: none; color: #555; border-radius: 10px; }
        .mode-button.active { background: #FF6B6B; color: white; }
        #swiper-container { display: none; width: 100%; flex-grow: 1; }
        #swiper-container.active { display: block; }
        .swiper-wrapper { height: 100%; }
        .swiper-slide { height: 100%; background-color: white; background-size: contain; background-position: center; background-repeat: no-repeat; }
        .clickable-area { position: absolute; cursor: pointer; border-radius: 20px; }
        .sound-area { top: 5%; right: 5%; width: 15%; height: 10%; }
        .ok-area { bottom: 5%; left: 5%; width: 30%; height: 15%; }
        .review-area { bottom: 5%; left: 37.5%; width: 25%; height: 15%; }
        .next-area { bottom: 5%; right: 5%; width: 20%; height: 15%; }
        #results-page { display: none; background-color: #f8f8f8; padding: 40px 20px; box-sizing: border-box; text-align: center; height: 100%; overflow-y: auto;}
        #results-page.active { display: block; }
        .progress-bar-container { width: 100%; background-color: #e0e0e0; border-radius: 10px; margin: 20px 0; }
        .progress-bar { height: 20px; background-color: #4CAF50; border-radius: 10px; width: 0%; transition: width 0.5s ease-in-out; }
        .result-title { font-size: 1.8em; font-weight: bold; margin-bottom: 10px;}
        .result-summary { font-size: 1.2em; margin-bottom: 30px; }
        .result-coaching { text-align: left; background-color: white; padding: 20px; border-radius: 12px; margin-top: 20px;}
        #show-results-btn { display: none; padding: 20px; width: 100%; background: #007BFF; color: white; border: none; font-size: 1.2em; cursor: pointer; position: absolute; bottom: 0; left: 0; }
    </style>
</head>
<body>
    <div id="app-frame">
        <div id="splash-screen"></div>
        <div id="app-container">
            <div class="mode-selector">
                <button id="all-mode-btn" class="mode-button active">ì „ì²´ í•™ìŠµ</button>
                <button id="review-mode-btn" class="mode-button">ë³µìŠµ í•˜ê¸°</button>
            </div>
            <div id="swiper-container" class="swiper-container active">
                <div class="swiper-wrapper"></div>
            </div>
            <button id="show-results-btn">ê²°ê³¼ ë³´ê¸°</button>
            <div id="results-page" class="results-page">
                <h2 class="result-title">ğŸ‰ ì°¸ ì˜í–ˆì–´ìš”! ğŸ‰</h2>
                <p class="result-summary" id="result-summary-text"></p>
                <div class="progress-bar-container"><div id="progress-bar" class="progress-bar"></div></div>
                <div class="result-coaching" id="result-coaching-text"></div>
            </div>
        </div>
    </div>

    <script>
        (function() {
            const words = [
                { id: 1, text: 'ì‚¬ê³¼', image: 'images/apple.png', category: 'ë§ˆì°°ìŒ' },
                { id: 2, text: 'ë°”ë‚˜ë‚˜', image: 'images/banana.png', category: 'ìœ ìŒ/ë¹„ìŒ' },
                { id: 3, text: 'ë”¸ê¸°', image: 'images/strawberry.png', category: 'ëœì†Œë¦¬' },
                { id: 4, text: 'í¬ë„', image: 'images/grape.png', category: 'ê±°ì„¼ì†Œë¦¬' },
                { id: 5, text: 'ìˆ˜ë°•', image: 'images/watermelon.png', category: 'ë§ˆì°°ìŒ' },
                { id: 6, text: 'ê·¤', image: 'images/tangerine.png', category: 'ê¸°ë³¸/ë³µí•©' },
                { id: 7, text: 'ë°°', image: 'images/pear.png', category: 'ê¸°ë³¸/ë³µí•©' },
                { id: 8, text: 'ë³µìˆ­ì•„', image: 'images/peach.png', category: 'ë§ˆì°°ìŒ' },
                { id: 9, text: 'ì˜¤ë Œì§€', image: 'images/orange.png', category: 'ìœ ìŒ/ë¹„ìŒ' },
                { id: 10, text: 'í‚¤ìœ„', image: 'images/kiwi.png', category: 'ì´ì¤‘ëª¨ìŒ' },
                { id: 11, text: 'ì°¸ì™¸', image: 'images/melon.png', category: 'ì´ì¤‘ëª¨ìŒ' },
                { id: 12, text: 'íŒŒì¸ì• í”Œ', image: 'images/pineapple.png', category: 'ê±°ì„¼ì†Œë¦¬' },
                { id: 13, text: 'ê°•ì•„ì§€', image: 'images/dog.png', category: 'ê¸°ë³¸/ë³µí•©' },
                { id: 14, text: 'ê³ ì–‘ì´', image: 'images/cat.png', category: 'ê¸°ë³¸/ë³µí•©' },
                { id: 15, text: 'í˜¸ë‘ì´', image: 'images/tiger.png', category: 'ë§ˆì°°ìŒ' },
                { id: 16, text: 'ì‚¬ì', image: 'images/lion.png', category: 'ë§ˆì°°ìŒ' },
                { id: 17, text: 'ì½”ë¼ë¦¬', image: 'images/elephant.png', category: 'ê±°ì„¼ì†Œë¦¬' },
                { id: 18, text: 'ê¸°ë¦°', image: 'images/giraffe.png', category: 'ìœ ìŒ/ë¹„ìŒ' },
                { id: 19, text: 'í† ë¼', image: 'images/rabbit.png', category: 'ëœì†Œë¦¬' },
                { id: 20, text: 'ì›ìˆ­ì´', image: 'images/monkey.png', category: 'ì´ì¤‘ëª¨ìŒ' },
                { id: 21, text: 'ê³°', image: 'images/bear.png', category: 'ê¸°ë³¸/ë³µí•©' },
                { id: 22, text: 'ë¼ì§€', image: 'images/pig.png', category: 'ì´ì¤‘ëª¨ìŒ' },
                { id: 23, text: 'ë‹­', image: 'images/chicken.png', category: 'ê¸°ë³¸/ë³µí•©' },
                { id: 24, text: 'ë³‘ì•„ë¦¬', image: 'images/chick.png', category: 'ëœì†Œë¦¬' }
            ];

            let reviewList = JSON.parse(localStorage.getItem('malggotReviewList')) || [];
            let swiper = null;
            let currentMode = 'all';

            function createSlide(word) {
                return `<div class="swiper-slide" style="background-image: url('${word.image}');" data-id="${word.id}" data-text="${word.text}"><div class="clickable-area sound-area"></div><div class="clickable-area ok-area"></div><div class="clickable-area review-area"></div><div class="clickable-area next-area"></div></div>`;
            }

            function initializeSwiper(wordList, isLoop) {
                const swiperContainer = document.getElementById('swiper-container');
                const swiperWrapper = swiperContainer.querySelector('.swiper-wrapper');
                
                if (!swiperContainer || !swiperWrapper) {
                    console.error('Swiper ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                if (typeof Swiper === 'undefined') {
                    console.error('Swiper ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    setTimeout(function() { initializeSwiper(wordList, isLoop); }, 100);
                    return;
                }

                swiperWrapper.innerHTML = '';
                if (wordList.length === 0) {
                    swiperWrapper.innerHTML = '<div class="swiper-slide" style="background-image: none; font-size:1.5em; display:flex; justify-content:center; align-items:center;">ë³µìŠµí•  ë‹¨ì–´ê°€ ì—†ì–´ìš”!</div>';
                    if (swiper) swiper.destroy(true, true);
                    swiper = null;
                    return;
                }
                
                wordList.forEach(word => {
                    swiperWrapper.innerHTML += createSlide(word);
                });
                
                if (swiper) {
                    swiper.destroy(true, true);
                }
                
                swiper = new Swiper(swiperContainer, { loop: isLoop });
                
                if (currentMode === 'all' && !isLoop) {
                    swiper.on('reachEnd', function() {
                        setTimeout(function() {
                            if (swiper && swiper.isEnd) {
                                const btn = document.getElementById('show-results-btn');
                                if (btn) btn.style.display = 'block';
                            }
                        }, 300);
                    });
                }
            }

            function speak(text) {
                if ('speechSynthesis' in window) {
                    speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'ko-KR';
                    utterance.rate = 0.8;
                    speechSynthesis.speak(utterance);
                }
            }

            function showResults() {
                const swiperContainer = document.getElementById('swiper-container');
                const showBtn = document.getElementById('show-results-btn');
                const resultsPage = document.getElementById('results-page');
                
                if (swiperContainer) swiperContainer.classList.remove('active');
                if (showBtn) showBtn.style.display = 'none';
                if (resultsPage) resultsPage.classList.add('active');

                const totalCount = words.length;
                const perfectCount = totalCount - reviewList.length;
                const summaryEl = document.getElementById('result-summary-text');
                const progressBar = document.getElementById('progress-bar');
                const coachingText = document.getElementById('result-coaching-text');
                
                if (summaryEl) {
                    summaryEl.textContent = `ì´ ${totalCount}ê°œ ì¤‘ ${perfectCount}ê°œë¥¼ ì™„ë²½í•˜ê²Œ ë°œìŒí–ˆì–´ìš”!`;
                }
                
                if (progressBar) {
                    const percentage = totalCount > 0 ? (perfectCount / totalCount) * 100 : 0;
                    progressBar.style.width = percentage + '%';
                }

                if (coachingText) {
                    let coachingHTML = "<h4>â­ ë§ê½ƒì´ë„¤ ì½”ì¹­ â­</h4>";
                    const reviewWords = words.filter(word => reviewList.includes(word.id));
                    if (reviewWords.length === 0) {
                        coachingHTML += "<p>ëª¨ë“  ë‹¨ì–´ë¥¼ ì™„ë²½í•˜ê²Œ ì•Œê³  ìˆë„¤ìš”! ì •ë§ ëŒ€ë‹¨í•´ìš”! ğŸ‘</p>";
                    } else {
                        const categoryCounts = {};
                        reviewWords.forEach(word => {
                            categoryCounts[word.category] = (categoryCounts[word.category] || 0) + 1;
                        });
                        const mostChallenging = Object.keys(categoryCounts).reduce(function(a, b) {
                            return categoryCounts[a] > categoryCounts[b] ? a : b;
                        });
                        coachingHTML += `<p>ìš°ë¦¬ ì•„ì´ëŠ” <strong>'${mostChallenging}'</strong> ë°œìŒì„ ì¡°ê¸ˆ ì–´ë ¤ì›Œí•˜ëŠ” ê²ƒ ê°™ì•„ìš”!</p>`;
                        switch (mostChallenging) {
                            case 'ëœì†Œë¦¬':
                                coachingHTML += "<p>ê´œì°®ì•„ìš”! 'ëœì†Œë¦¬(ã„²,ã„¸,ã…ƒ,ã…†,ã…‰)'ëŠ” ë§ì€ ì•„ì´ë“¤ì´ ì–´ë ¤ì›Œí•´ìš”. 'ê°œë¯¸ ëª©ì†Œë¦¬'ì²˜ëŸ¼ ì‘ê³  ì†ì‚­ì´ë“¯ ë°œìŒí•˜ëŠ” ì—°ìŠµì´ ë„ì›€ì´ ë  ìˆ˜ ìˆë‹µë‹ˆë‹¤.</p>";
                                break;
                            case 'ê±°ì„¼ì†Œë¦¬':
                                coachingHTML += "<p>ì†ë°”ë‹¥ì— ë°”ëŒì„ 'í›„!' ë¶ˆì–´ë³´ëŠ” ê²ƒì²˜ëŸ¼, 'ê±°ì„¼ì†Œë¦¬(ã…‹,ã…Œ,ã…,ã…Š)'ëŠ” ë°”ëŒì´ ë‚˜ì˜¤ëŠ” ì†Œë¦¬ë¼ëŠ” ê±¸ ì•Œë ¤ì£¼ë©´ ì¬ë¯¸ìˆê²Œ ë°°ìš¸ ìˆ˜ ìˆì–´ìš”.</p>";
                                break;
                            case 'ë§ˆì°°ìŒ':
                                coachingHTML += "<p>'ë§ˆì°°ìŒ(ã……,ã…†,ã…)'ì€ ë±€ì´ ì§€ë‚˜ê°€ëŠ” ì†Œë¦¬(ìŠ¤ìœ¼~)ë‚˜ ë°”ëŒ ì†Œë¦¬(í›„ìš°~)ë¥¼ í‰ë‚´ ë‚´ë©° ë†€ì´ì²˜ëŸ¼ ì ‘ê·¼í•˜ë©´ íš¨ê³¼ì ì´ëë‹ˆë‹¤.</p>";
                                break;
                            default:
                                coachingHTML += "<p>ë‹¤ì–‘í•œ ë‹¨ì–´ë“¤ì„ ê¾¸ì¤€íˆ ë°˜ë³µí•´ì„œ ë“¤ë ¤ì£¼ê³  ë”°ë¼ ë§í•´ë³´ëŠ” ê²ƒë§Œìœ¼ë¡œë„ í° ë„ì›€ì´ ë  ê±°ì˜ˆìš”!</p>";
                        }
                    }
                    coachingText.innerHTML = coachingHTML;
                }
            }

            function initApp() {
                const swiperContainer = document.getElementById('swiper-container');
                if (!swiperContainer) return;

                swiperContainer.addEventListener('click', function(event) {
                    if (!swiper) return;
                    const activeSlide = swiper.slides[swiper.activeIndex];
                    if (!activeSlide) return;
                    const wordId = parseInt(activeSlide.dataset.id);

                    if (event.target.matches('.sound-area')) {
                        speak(activeSlide.dataset.text);
                    } else if (event.target.matches('.ok-area')) {
                        reviewList = reviewList.filter(function(id) { return id !== wordId; });
                        localStorage.setItem('malggotReviewList', JSON.stringify(reviewList));
                        if (swiper) swiper.slideNext();
                    } else if (event.target.matches('.review-area')) {
                        if (reviewList.indexOf(wordId) === -1) {
                            reviewList.push(wordId);
                        }
                        localStorage.setItem('malggotReviewList', JSON.stringify(reviewList));
                        if (swiper) swiper.slideNext();
                    } else if (event.target.matches('.next-area')) {
                        if (swiper) swiper.slideNext();
                    }
                });

                const allModeBtn = document.getElementById('all-mode-btn');
                const reviewModeBtn = document.getElementById('review-mode-btn');
                const showResultsBtn = document.getElementById('show-results-btn');

                if (allModeBtn) {
                    allModeBtn.addEventListener('click', function() {
                        currentMode = 'all';
                        allModeBtn.classList.add('active');
                        if (reviewModeBtn) reviewModeBtn.classList.remove('active');
                        if (swiperContainer) swiperContainer.classList.add('active');
                        const resultsPage = document.getElementById('results-page');
                        if (resultsPage) resultsPage.classList.remove('active');
                        if (showResultsBtn) showResultsBtn.style.display = 'none';
                        initializeSwiper(words, false);
                    });
                }

                if (reviewModeBtn) {
                    reviewModeBtn.addEventListener('click', function() {
                        currentMode = 'review';
                        reviewModeBtn.classList.add('active');
                        if (allModeBtn) allModeBtn.classList.remove('active');
                        if (swiperContainer) swiperContainer.classList.add('active');
                        const resultsPage = document.getElementById('results-page');
                        if (resultsPage) resultsPage.classList.remove('active');
                        if (showResultsBtn) showResultsBtn.style.display = 'none';
                        const reviewWords = words.filter(function(word) {
                            return reviewList.indexOf(word.id) !== -1;
                        }).sort(function() { return Math.random() - 0.5; });
                        initializeSwiper(reviewWords, true);
                    });
                }

                if (showResultsBtn) {
                    showResultsBtn.addEventListener('click', showResults);
                }

                initializeSwiper(words, false);
            }

            document.addEventListener('DOMContentLoaded', function() {
                const splashScreen = document.getElementById('splash-screen');
                const appContainer = document.getElementById('app-container');

                if (!splashScreen || !appContainer) {
                    console.error('í•„ìˆ˜ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                splashScreen.addEventListener('click', function() {
                    splashScreen.style.opacity = '0';
                    setTimeout(function() {
                        splashScreen.style.display = 'none';
                        appContainer.style.display = 'flex';
                        initApp();
                    }, 500);
                });
            });
        })();
    </script>
</body>
</html>